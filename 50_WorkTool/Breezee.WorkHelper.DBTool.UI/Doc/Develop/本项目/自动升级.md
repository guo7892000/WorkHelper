## 本项目-自动升级
登录后，或点击【检查更新】时触发升级。步骤：  
1.比较远程版本跟本地版本。只有远端版本大于本地版本时，才会下载远端文件。  
2.下载远端升级包，并解压。  
3.解压完成后，根据配置是否升级包（默认删除）。  
4.备份上个版本目录里的数据库文件到新目录，并更新桌面方式指向新目录。  
5.提示升级完毕，是否重启应用？选是则会重新打开应用。  
6.登录系统时，检查到有旧版本，提示是否删除旧版本。选是则会删除上个版本目录。  
7.进入新系统。
### 下载
```
//下载地址（外网可直接访问）：https://gitee.com/breezee2000/WorkHelper/releases/download/1.2.24/WorkHelper1.2.24.rar
//下载到临时文件：tmpZipName为本地文件全路径
var tmpZipName = sFullZipPath + ".tmp";
using (var web = new WebClient())
{
    /* 只有访问网站提供的发布目录才正常，如访问工程其他文件夹（master或dev分支的），是需要登录的，那样就下载不了发布包了。
        * 所以为了解决这个问题，只能在多个代码托管服务器发布，从其中任一个下载即可。
        * 注：gitee上发布包占用的空间是有限的。如果超了，发布包发布不上去的，删除之前的一些发布包，再重新发布即可。
        */
    await web.DownloadFileTaskAsync(upgradeInfo.Server.DownloadUrl, tmpZipName);
}

// 解压文件：使用SharpCompress.Archives解压
UpgradeFinishData data = new UpgradeFinishData(upgradeInfo.Client.ParentDir, upgradeInfo.Server.AppVersion, sFullZipPath, tmpZipName, upgradeInfo.Client.IsDeleteNewVerZipFile);
DownFileFinished(data);


```

### 解压文件
使用SharpCompress.Archives解压，它支持各种后缀的压缩文件。
```
public static bool ExtractArchive(string archivePath, string extractPath)
{
    try
    {
        using (var archive = ArchiveFactory.Open(archivePath))
        {
            foreach (var entry in archive.Entries)
            {
                if (!entry.IsDirectory)
                {
                    entry.WriteToDirectory(extractPath, new ExtractionOptions()
                    {
                        ExtractFullPath = true,
                        Overwrite = true
                    });
                }
            }
        }
        return true;
    }
    catch(Exception ex) 
    {
        Console.WriteLine(ex.Message);
        return false;
    }
}
```