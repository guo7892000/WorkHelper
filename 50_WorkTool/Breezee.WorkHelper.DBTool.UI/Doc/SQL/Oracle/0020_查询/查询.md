### 查询
#### 使用WITH临时表
```
/*使用临时表查询SQL*/
WITH tempKPI AS (select TO_NUMBER(SUBSTR(KPI.YEAR_MONTH, -2)) AS MONTHS,
       KPI.PART_PZ_RATE /*备件品种满足率*/,
       KPI.NEED_VARIETY_ALL /*必备件品种满足率*/,
       KPI.LP_RELIEVE_TIME_ALL /*缺件平均解除时间*/,
       KPI.STORE_RATE /*库存度*/,
       KPI.BO_RATE /*长期BO率*/,
       KPI.ORDER_RATE /*订货波动率*/,
       KPI.REACH_RATE /*到货满足率*/,
       KPI.EO_RATE /*紧急订单率EO*/
 FROM T_PA_BU_PART_MONTH_KPI KPI
 WHERE KPI.NET_CODE= 'H2904'--'#NET_CODE#'
 AND SUBSTR(KPI.YEAR_MONTH,0,4) = '2011'--'#YYYY#%'
 ) 
select '', decode(months,1,PART_PZ_RATE,0)
from tempKPI

/*针对重复数据中获取某行数据*/
SELECT *
  FROM (SELECT *
          FROM (SELECT A.*,
                       ROW_NUMBER() OVER(PARTITION BY A.BUYUPNO ORDER BY A.BUYUPNO) RN
                  FROM T_CAR_STORE@MD_DL_EABUC A) X
         WHERE X.RN = 1) A
  LEFT JOIN (SELECT *
               FROM (SELECT B.*,
                            ROW_NUMBER() OVER(PARTITION BY B.BUYUPNO ORDER BY B.BUYUPNO) RN
                       FROM T_MEMU_CONTRACT_M@MD_DL_EABUC B
                      WHERE B.CONTRACT_TYPE IN ('0', '1')) X
              WHERE X.RN = 1) B
    ON A.BUYUPNO = B.BUYUPNO
  LEFT JOIN T_CAR_CATTYPESET@MD_DL_EABUC C
    ON A.CATTYPESETID = C.CATTYPESETID


/*将某一列数据以单列显示*/
SELECT A.PART_BRAND_CODE,
       LISTAGG(A.CAR_BRAND_CODE, ',') WITHIN GROUP(ORDER BY A.PART_BRAND_CODE) AS CAR_BRAND_CODE
  FROM T_PA_DB_PART_BRAND_DETAIL A
 WHERE A.IS_ENABLE = '1'
 GROUP BY A.PART_BRAND_CODE;



/*语法：DENSE_RANK() OVER ([PARTITION BY partition_expression] ORDER BY sort_expression [ASC|DESC])
rank()：返回的数据排名会跳跃；案例:1，2，2，2，5
dense_rank()：返回的数据排名不会跳跃；1，2，2，2，3
row_number()：递增序列;1,2,3,4,5
partition by对结果集进行分区。
partition by只是将原始数据进行名次排列(记录数不变)
group by是对原始数据进行聚合统计(记录数可能变少, 每组返回一条)
使用rank over()的时候，空值是最大的，如果排序字段为null, 可能造成null字段排在最前面，影响排序结果。
*/

select student_name,
      score ,
      rank() over(order by score ) rank,
      dense_rank() over(order by score ) dense_rank,
      row_number() over(order by score ) row_number,
      rank() over (partition by course order by score desc),
      dense_rank() over (partition by course order by score desc),
      row_number() over (partition by course order by score desc)
 from T_STUDENT ;

/*SQL中的SQL，把单引号换成两个单引号就好了*/
SELECT 'INSERT INTO (a, b,c,d) VALUES(''aa'', 2, '''',3)' from dual;

```
### 分拆逗号分隔的字段返回多行
```
select regexp_substr('男,女', '[^,]+', 1, level) as col
from dual
connect by level <= length('男,女')-length(REPLACE('男,女', ',', '')) + 1;
```