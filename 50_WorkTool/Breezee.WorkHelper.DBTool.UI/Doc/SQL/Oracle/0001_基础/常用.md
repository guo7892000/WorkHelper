### 常用
```
/*格式转换*/
TO_CHAR('#DATE#','YYYY-MM-DD')
TO_DATE('#DATE#','YYYY-MM-DD')

/*注：Oracle的对象命名长度：小于等于30*/

/*查询变更的对象*/
SELECT A.OWNER, A.OBJECT_NAME
  FROM ALL_OBJECTS A
 WHERE A.OBJECT_TYPE IN ('PROCEDURE', 'TRIGGER', 'VIEW')
   AND A.OWNER IN ('UC')
   AND A.LAST_DDL_TIME > SYSDATE - 2
   AND A.STATUS = 'VALID'
UNION
SELECT A.OWNER, A.OBJECT_NAME
  FROM ALL_OBJECTS A
 WHERE A.OBJECT_TYPE IN ('PROCEDURE', 'TRIGGER', 'VIEW')
   AND A.OWNER IN ('IFR', 'IFS')
   AND A.LAST_DDL_TIME > SYSDATE - 2
   AND A.STATUS = 'VALID';

/*创建序列：从10000开始，每次增长1。*/
CREATE SEQUENCE SEQT_PORTAL_RPT_ID MINVALUE 1 MAXVALUE 999999999999999999999999999 START WITH 10000 INCREMENT BY 1 CACHE 20;

/*操作表常用SQL*/
COMMENT ON TABLE TEST1 IS '测试表';--给表填加注释
COMMENT ON COLUMN T_AI_BU_INSURE_ORDER.LINK_NO IS '合同单号';--给列加注释
ALTER TABLE TEST1 MODIFY PLANMONTH NUMBER;
ALTER TABLE TEST1 ADD LONG1 LONG;
ALTER TABLE TEST1 ADD DFD NUMBER(14,2) DEFAULT 0;
ALTER TABLE TEST1 ADD FDFED NUMBER DEFAULT 1;
ALTER TABLE TEST1 ADD CONSTRAINT PK_ID PRIMARY KEY (ID);
ALTER TABLE TEST1 ADD CONSTRAINT FK_D_ID FOREIGN KEY (D_ID) REFERENCES TEST2 (RID);
ALTER TABLE TEST1 ADD CONSTRAINT U_DFD UNIQUE (PLANMONTH);
ALTER TABLE TEST1 DROP COLUMN PLANMONTH;

/*增加列和注释*/
1、给表填加注释：COMMENT ON TABLE 表名 IS '表注释';
2、给列加注释：COMMENT ON COLUMN 表.列 IS '列注释';
3、读取表注释：SELECT * FROM USER_TAB_COMMENTS WHERE COMMENTS IS NOT NULL;
4、读取列注释：SELECT * FROM USER_COL_COMMNENTS WHERE COMMENTS IS NOT NULL AND TABLE_NAME='表名';

/*oracle 排序后取第一条记录*/
select * from (select * from table order by a )C
where rownum=1;

/*增加索引*/
CREATE INDEX IDX1_T_UC_BU_BUY_CONTRACT ON T_UC_BU_BUY_CONTRACT(OPRATE_TIME) TABLESPACE UC_IDX_TBS;

/*返回时间段的自增长的自定列*/
SELECT TO_CHAR(ADD_MONTHS(TO_DATE('20150525', 'YYYYMMDD'), 1 - LEVEL),
                 'YYYYMM') MONTHS
    FROM DUAL
  CONNECT BY LEVEL <= 12;

/*针对重复数据中获取某行数据*/
SELECT *
  FROM (SELECT *
          FROM (SELECT A.*,
                       ROW_NUMBER() OVER(PARTITION BY A.BUYUPNO ORDER BY A.BUYUPNO) RN
                  FROM T_CAR_STORE@MD_DL_EABUC A) X
         WHERE X.RN = 1) A
  LEFT JOIN (SELECT *
               FROM (SELECT B.*,
                            ROW_NUMBER() OVER(PARTITION BY B.BUYUPNO ORDER BY B.BUYUPNO) RN
                       FROM T_MEMU_CONTRACT_M@MD_DL_EABUC B
                      WHERE B.CONTRACT_TYPE IN ('0', '1')) X
              WHERE X.RN = 1) B
    ON A.BUYUPNO = B.BUYUPNO
  LEFT JOIN T_CAR_CATTYPESET@MD_DL_EABUC C
    ON A.CATTYPESETID = C.CATTYPESETID
;

---测试单号生成
DECLARE V_CODE VARCHAR2(50); 
        v_num NUMBER;
BEGIN
	for v_num in 1 .. 100 LOOP
		p_mds_get_form_code('','2057',V_CODE);
		dbms_output.put_line(V_CODE);
	END LOOP;
END;  

/*返回时间段（年、月、日）的自增长的自定列*/
SELECT DECODE('2',/*指定时间类型：1年，2月份，3天*/
  '1',
  ADD_MONTHS(TO_DATE('20160525', 'YYYYMMDD'), (LEVEL-1)*12),
  '2',
  ADD_MONTHS(TO_DATE('20150525', 'YYYYMMDD'), LEVEL-1),
  '3',
  TO_DATE('20150522', 'YYYYMMDD') + LEVEL-1)
FROM DUAL
CONNECT BY LEVEL <= DECODE('2',/*指定时间类型：1年，2月份，3天*/
  '1',
  TO_CHAR(TO_DATE('20160625', 'YYYYMMDD'),'YYYY')-TO_CHAR(TO_DATE('20160125', 'YYYYMMDD'),'YYYY')+1,
  '2',
  FLOOR(MONTHS_BETWEEN(TO_DATE('20150625', 'YYYYMMDD'), TO_DATE('20150501', 'YYYYMMDD')))+1,
  '3',
  TRUNC(TO_DATE('20150523', 'YYYYMMDD'))-TRUNC(TO_DATE('20150522', 'YYYYMMDD'))+1
	)
;

/*增加列*/
  ALTER TABLE emp01 ADD eno NUMBER(4);

/*修改列定义*/
  ALTER TABLE emp01 MODIFY job VARCHAR2(15)  DEFAULT 'CLERK';

/*删除列*/
  ALTER TABLE emp01 DROP COLUMN dno;

/*修改列名*/
  ALTER TABLE emp01 RENAME COLUMN eno TO empno;

/*修改表名*/
  RENAME emp01 TO employee;

/*先删除后增加主键*/
ALTER TABLE MQ_PS_PREPARE DROP CONSTRAINT PK_MQ_PS_PREPARE;
ALTER TABLE MQ_PS_PREPARE ADD CONSTRAINT PK_MQ_PS_PREPARE PRIMARY KEY (OID);

/*增加自增长序列*/
CREATE OR REPLACE TRIGGER TR_MQSEND_TEMP_RECORDID
BEFORE INSERT ON MQSEND_TEMP
FOR EACH ROW
BEGIN
SELECT SE_MQSEND_TEMP.NEXTVAL INTO :NEW.RECORDID FROM DUAL;
END;

/*视图创建同义词并授权*/
GRANT SELECT ON UC.V_UC_QUERY_STORE_CAR TO MDS_ROLE;  
CREATE OR REPLACE SYNONYM MDS.V_UC_QUERY_STORE_CAR FOR UC.V_UC_QUERY_STORE_CAR;  
GRANT SELECT ON UC.V_UC_QUERY_STORE_CAR TO MDS WITH GRANT OPTION;

/*判断影响行*/
UPDATE TB_NETYKRUNLOG SET NETYKSPNAME='P_AUTO_QJ' WHERE  NUM=1 AND NETYKSPNAME IS NULL;
IF SQL%ROWCOUNT=1 THEN
 --dong something
 v:='可d要地一杀敌';
 dbms_output.put_line(substr(v, 2, 3));
END IF;

/*动态删除表SQL：*/
declare  cnt  number;
begin
  ---删除表COC_CAL_GoodReturn
  select count(1) into cnt from user_objects where upper(object_name) = 'COC_CAL_GOODRETURN' and upper(object_type) = 'TABLE'; 
  if cnt = 1 then 
    begin 
      execute immediate 'DROP TABLE COC_CAL_GOODRETURN';
    end;
  end if;
END;

/*动态修改表，并增加注释*/
declare cnt number; 
begin 
 ---修改专营店表增加列DEALER_CODE_O,并增加注释
 select count(1) into cnt from user_tab_columns where upper(table_name) = 'COC_BAS_DEALER' and upper(column_name) = 'DEALER_CODE_O'; 
 if cnt = 0 then 
   begin 
      execute immediate 'ALTER TABLE COC_BAS_DEALER ADD (DEALER_CODE_O varchar2(10))'; 
      execute immediate 'COMMENT ON column COC_BAS_DEALER.DEALER_CODE_O IS ' || '''专营店编码'''; 
   end; 
 end if;
END;

/*合并更新语句*/
MERGE INTO T_PA_BU_PUR_ORDER_D U
USING (SELECT SUM(NVL(B.IN_QTY, 0)) AS T_IN_QTY, B.PART_NO
             FROM T_PA_BU_IN_ORDER A
             LEFT JOIN T_PA_BU_IN_ORDER_D B
               ON A.IN_ORDER_ID = B.IN_ORDER_ID
            WHERE B.SOURCE_ORDER_CODE = V_ORDER_NO /*关联单号:外购单号*/
              and A.net_code = NetCode
            GROUP BY B.PART_NO
	  ) F
ON (U.PART_NO = F.PART_NO)
    WHEN MATCHED THEN
      UPDATE
         SET U.IN_STOCK_QTY      = F.T_IN_QTY,
             U.LAST_UPDATED_DATE = systimestamp
       WHERE POD.PUR_ORDER_ID =
             (select pur_order_id
                from T_PA_BU_PUR_ORDER
               where pur_order_code = V_ORDER_NO
                 and net_code = NetCode); /*采购单ID*/

/*将某一列数据以单列显示*/
SELECT A.PART_BRAND_CODE,
       LISTAGG(A.CAR_BRAND_CODE, ',') WITHIN GROUP(ORDER BY A.PART_BRAND_CODE) AS CAR_BRAND_CODE
  FROM T_PA_DB_PART_BRAND_DETAIL A
 WHERE A.IS_ENABLE = '1'
 GROUP BY A.PART_BRAND_CODE;

/*视图授权与创建同义词*/
grant select on uc.v_uc_carprice to mds ;
create or replace synonym mds.v_uc_carprice for uc.v_uc_carprice;

--查看任务：
select * from user_jobs;
select * from all_jobs;
--查看正在运行的任务（不推荐使用，速度慢）：
select * from dba_jobs_running;


/*声明*/
v_Dms_NetCode eabuc.t_org_dealer.dealerno%Type;
Cursor curBalance is
    Select * from eabuc.PS_U_T_MEMU_CERTIFICATE;
  RecBalance curBalance%RowType;
begin
  open curBalance;
  loop
    Fetch curBalance
      into RecBalance;
    Exit when curBalance%NotFound;
	  begin
		/*逻辑处理，此处略*/

		  commit;
		WHEN OTHERS THEN
			/*事务回滚*/
			Rollback; 
			/*抛出系统错误*/
			RAISE_APPLICATION_ERROR(-20999, sqlerrm);
	 end;
  end loop;
  close curBalance;
end;

/*查询版本*/
select * from v$version

/*查询存储过程内容*/
select * from dba_source a where a.name='SP_MDM_PRO_SEND_TOUCCUST'
/*查看oracle数据文件存放路径*/
select * from v$datafile;


```
