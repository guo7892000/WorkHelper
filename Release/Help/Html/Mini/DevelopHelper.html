<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>开发说明</title>
</head>
<body>
    <div>
        <h1>开发说明</h1>
        <div>
            <h2>一、概述</h2>
            使用本框架的开发说明。
        </div>
        <div>
            <h2>二、配置类说明</h2>
            <b>1、键值对配置(单组固定属性)：</b><br>
            KeyValuePairConfig：根节点config；子节点data包括key、value、remark三种属性。主要针对某一种功能的单个文件配置，如菜单是否在工具栏上显示。<br>
            <b>2、键值对配置(多组固定属性)：</b><br>
            KeyValueGroupConfig：根节点xml；分组节点key包括kid、name属性；子节点value包括vid、name。例如值列表。<br>
            <b>3、更多键值对配置(多组自定义属性)：最灵活</b><br>
            MoreKeyValueGroupConfig：根节点xml；分组节点key包括kid、name属性；子节点value包括vid、name。例如值列表。<br>
        </div>

        <div>
            <h2>三、IOC配置：使用其中一个即可。</h2>
            <b>Castle：</b>
            <pre><code>
    \Breezee.Framework.Mini.BLL\MiniBllIocInstallerCastle.cs
    \Breezee.Framework.Mini.DAL\MiniDalIocInstallerCastle.cs
    \Breezee.WorkHelper.DBTool.BLL\DBToolBllIocInstallerCastle.cs
    \Breezee.WorkHelper.DBTool.DAL\DBToolDalIocInstallerCastle.cs
            </code></pre>
            <b>Autofac：</b>
            <pre><code>
    \Breezee.Framework.Mini.DAL\MiniDalIocModuleAutofac.cs
    \Breezee.WorkHelper.DBTool.BLL\DBToolBllIocModuleAutofac.cs
    \Breezee.WorkHelper.DBTool.DAL\DBToolDalIocModuleAutofac.cs
            </code></pre>
            <b>注册使用的IoC代码（Program.cs）：</b>
            <pre><code>
    //IoC容器的DLL注册类
    IoCDllRegister.Reg(new string[]
    {
        "Breezee.Core.Adapter.BLL",
        "Breezee.AutoSQLExecutor.Common",
        "Breezee.Framework.Mini.BLL",
        "Breezee.Framework.Mini.DAL",
        "Breezee.Framework.Mini.DAL.SQLite",
        "Breezee.WorkHelper.DBTool.BLL",
        "Breezee.WorkHelper.DBTool.DAL",
        "Breezee.WorkHelper.DBTool.DAL.SQLite"
    });
            </code></pre>
            <b>IoC上下文类（\Breezee.Core.IOC\ContainerContext.cs）：</b>使用Container即是使用Castle；使用AutofacContainer即是使用Autofac。</b>
            <pre><code>
    public class ContainerContext
    {
        private static ICastleContainer container = new CastleContainer();

        public static ICastleContainer Container
        {
            get { return container; }
        }


        private static IAutofacContainer facContainer = new AutofacContainer();

        public static IAutofacContainer AutofacContainer
        {
            get { return facContainer; }
        }
    }
        </code></pre>
        </div>
        <div>
            <h2>四、数据访问类</h2>
            <div>
                <h4>4.1、使用【个人SQL自动执行器】：Breezee.AutoSQLExecutor.Core</h4>
                <pre><code>
    //从配置表中读取SQL查询
    DataTable dtData = DataAccess.QueryAutoParamConfigPathData(@"SQL/DBTool/DBConfigSet/QueryDBConfig", dicQuery);
    //查询并返回结果
    string sSql = @"DELETE FROM DBT_BD_DB_CONFIG WHERE DB_CONFIG_ID = '#DB_CONFIG_ID#' ";
    int iUpdate = DataAccess.ExecuteNonQueryAutoParamSql(sSql, dicQuery);
                </code></pre>
                <h4>4.2、【个人SQL自动执行器】项目又引用的个人的另一个【SQL自动参数化】项目：MyPeach.Net</h4>
                <pre><code>
    MyPeachNetProperties pop = new MyPeachNetProperties();
    pop.TargetSqlParamTypeEnum = TargetSqlParamTypeEnum.DIRECT_RUN;
    SqlParsers sqlParsers = new SqlParsers(pop);

    string sSql = "SELECT * FROM BAS_PROVINCE T WHERE T.PROVINCE_ID = '#PROVINCE_ID#' and T.PROVINCE_CODE = '#PROVINCE_CODE#' and T.PROVINCE_NAME like '%#PROVINCE_NAME#%' ";
    IDictionary<string,object>  dicQuery = new Dictionary<string,object>();
    dicQuery.put("PROVINCE_ID", "张三");
    dicQuery.put("PROVINCE_CODE", "BJ");
    dicQuery.put("PROVINCE_NAME", "北京");
    ParserResult result = sqlParsers.parse(SqlTypeEnum.SELECT, sSql, dicQuery);
    System.Console.WriteLine(result.Code.Equals("0") ? result.Sql : result.Message);//0转换成功，返回SQL；1转换失败，返回错误信息
                </code></pre>
            </div>
        </div>
        <div>
            <h2>五、数据库及配置</h2>
            <div>
                <b>1、SQLite数据库文件：</b><br>
                框架数据库：SQLite_Mini.db<br>
                数据库工具：SQLite_DBTool.db<br>
                默认我们使用程序所在目录的数据库文件。<br>
                但我们也可以自定义其路径：先复制上述两个文件到系统分区外的目录，然后再通过【全局系统配置】下的【主框架DB配置】改变框架使用的数据库；<br>
                通过【DB工具系统配置】下的【数据库工具DB配置】改变数据库工具所使用的数据库。注： 我们只设置一次即可！<br>
                <b>2、配置文件（Config目录）：</b>这里只列比较重要的<br>
                <b>菜单配置：\Config\Mini\Data\MenuList.xml</b><br>
                其在Breezee.Framework.Mini.Entity项目下，记录本工具所有菜单（不包括【开始、视图、窗口、帮助】下所有菜单）。<br>
                <b>值列表配置：\Config\Mini\Data\KeyValue.xml</b><br>
                其在Breezee.Framework.Mini.Entity项目下，记录本工具用到的值列表。<br>
                <b>SQL主配置：\Config\SQL.Main.config</b><br>
                其在Breezee.AutoSQLExecutor.Core项目下，增加项目时需要修改该文件，增加新项目的SQL配置。<br>
                <b>IoC使用Castle.Windsor或Autofac</b><br>
                在每个子模块中继承它们的安装类，再加载其所在的DLL，实现接口与实现的注入。但需要引入Castle.Windsor或Autofac相关DLL。<br>
                摒弃了以前使用XML的方式，那样不容易在编译阶段发现错误！<br>
                主框架的数据库连接配置：Breezee.Framework.Mini.DAL.SQLite工程下的MiniDalSQLiteIocInstallerCastle或MiniDalSQLiteIocModuleAutofac。<br>
                <b>3、模板目录（DataTemplate）：</b>功能中所有下载的模板都来自于该目录。<br>
                <b>4、帮助目录（Help）：</b>所有功能的帮助文件html都在该目录下。<br>
                <b>5、SQL的配置与执行：</b>本工具使用本人另外的两个项目：MyPeach.Net和AutoSQLExecutor，以支持多种数据库、SQL的快速转换与执行。SQL语句可写在代码中或配置文件中。<br>
                SQL语句不需要拼接，MyPeach.Net会根据输入参数和原始SQL自动转换为参数化的SQL语句；AutoSQLExecutor支持MySql、Oracle、PostgreSQL、SqlServer、SQLite五种数据库类型的SQL执行，<br>
                需要我们按约定的规则来配置，包括：xx.DAL项目是所有数据库的基类，其下配置通用的SQL（即不包括特定数据库类型语句的语法），例如Mini.SQL.Common.config文件。<br>
                当SQL不能通用时，我们需要在具体的数据库类型访问层项目实现该方法，如xx.DAL.MySql项目，就是针对使用MySql数据库时，需要重写的方法（其中调用适用MySQL的SQL语句）。<br>
                然后IoC配置中，我们都是配置数据库访问实现类是使用对应数据库类型的实现类。这样当实现类不重写方法时，调用实现类的方法就是使用基类的方法。<br>
            </div>
        </div>

    </div>
</body>
</html>