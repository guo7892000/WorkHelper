## 本项目-树

### 左边菜单树及上面菜单项创建
```
//加载菜单方法
private void LoadMenu()
{
    //加载菜单
    tvLeftMenu.Nodes.Clear();
    //XML中的菜单处理
    _MenuDic = _xmlMenu.GetAllMenu();
            
    foreach (MenuEntity dMenu in _MenuDic.Values)
    {
        if (dMenu.MenuType != MenuType.Modul)
        {
            continue;
        }
        //菜单项
        ToolStripMenuItem tmiNew = new ToolStripMenuItem();
        tmiNew.Name = dMenu.Guid;
        tmiNew.Text = string.IsNullOrEmpty(dMenu.ShortCutKey)? dMenu.Name: string.Format("{0}(&{1})", dMenu.Name, dMenu.ShortCutKey);
        tmiNew.Tag = dMenu;
        dMenu.FullPath = dMenu.Name;
        menuStrip.Items.Insert(iStartMenu + 1, tmiNew);

        //左边树
        TreeNode tnNew = new TreeNode();
        tnNew.Name = dMenu.Guid;
        tnNew.Text = dMenu.Name;
        tnNew.Tag = dMenu;
        tvLeftMenu.Nodes.Add(tnNew);

        foreach (MenuEntity childMenu in dMenu.Childs.Values)
        {
            if (childMenu.MenuType == MenuType.Class)
            {
                AddMenuClassItem(tmiNew,new ToolStripMenuItem(), childMenu);
                AddMenuClassNode(tnNew,new TreeNode(), childMenu);
            }
            else
            {
                AddMenuItem(tmiNew, new ToolStripMenuItem(), childMenu);
                AddMenuNode(tnNew,new TreeNode(), childMenu);
            }
        }

        iStartMenu++;
    }
}

/// <summary>
/// 动态工具栏点击事件
/// </summary>
/// <param name="sender"></param>
/// <param name="e"></param>
private void DynamicToolStripButton_Click(object sender, EventArgs e)
{
    ToolStripButton button = sender as ToolStripButton;
    ToolStripMenuItem toolStripMenuItem = button.Tag as ToolStripMenuItem;
    toolStripMenuItem.PerformClick();
}

/// <summary>
/// 增加工具栏按钮
/// </summary>
/// <param name="menuItem"></param>
/// <param name="childMenu"></param>
private void AddMainToolStrip(ToolStripMenuItem menuItem,MenuEntity childMenu)
{
    //工具栏
    if (childMenu.IsShowInToolStrip)
    {
        int iToolIndex = tspMain.Items.IndexOf(saveToolStripButton);
        ToolStripButton button = new ToolStripButton();
        button.Tag = menuItem;
        button.DisplayStyle = ToolStripItemDisplayStyle.Image;
        button.Text = childMenu.Name;
        button.Image = Resources.loveStar;
        button.ToolTipText = childMenu.Name;
        tspMain.Items.Insert(iToolIndex, button);
        button.Click += DynamicToolStripButton_Click;//点击时调用原菜单项点击事件打开功能
    }
}

//增加菜单分类
private void AddMenuClassItem(ToolStripMenuItem tmiParent, ToolStripMenuItem tmiNew, MenuEntity dParentMenu)
{
    AddMenuItem(tmiParent, tmiNew, dParentMenu);
    foreach (MenuEntity childMenu in dParentMenu.Childs.Values)
    {
        if (childMenu.MenuType == MenuType.Class)
        {
            AddMenuClassItem(tmiNew, new ToolStripMenuItem(), childMenu);
        }
        else
        {
            var childMenuItem = new ToolStripMenuItem();
            AddMenuItem(tmiNew, childMenuItem, childMenu);
            if (!string.IsNullOrEmpty(childMenu.HelpPath))
            {
                WinFormContext.Instance.MenuHelpList.Add(new EntMenuHelp(childMenu.HelpPath, childMenu.FullPath, childMenu.Name));
            }

            //判断菜单ID的工具栏显示配置是否为1是
            var menShowInTool = _showInToolConfig.MoreXmlConfig.ListEntity.Where(x => x.Key.Equals(childMenu.Guid, StringComparison.OrdinalIgnoreCase) && "1".Equals(x.Value));
            if (menShowInTool.Count() > 0)
            {
                childMenu.IsShowInToolStrip = true;
                AddMainToolStrip(childMenuItem, childMenu);//增加工具栏按钮
            }
        }
    }
}

private void AddMenuClassNode(TreeNode tnParent, TreeNode tnNew, MenuEntity dParentMenu)
{
    AddMenuNode(tnParent, tnNew, dParentMenu);
    foreach (MenuEntity childMenu in dParentMenu.Childs.Values)
    {
        if (childMenu.MenuType == MenuType.Class)
        {
            AddMenuClassNode(tnNew, new TreeNode(), childMenu);
        }
        else
        {
            AddMenuNode(tnNew, new TreeNode(), childMenu);
        }
    }
} 

//增加菜单
private void AddMenuItem(ToolStripMenuItem tmiParent, ToolStripMenuItem tmiNew, MenuEntity dMenu)
{
    tmiNew.Text = string.IsNullOrEmpty(dMenu.ShortCutKey) ? dMenu.Name : string.Format("{0}(&{1})", dMenu.Name, dMenu.ShortCutKey);
    tmiNew.Name = dMenu.Guid;
    tmiNew.Tag = dMenu;
    tmiNew.Click += MenuItem_Click;
            
    //菜单查找自动完成数据源
    tstbMenuSearch.AutoCompleteCustomSource.Add(dMenu.Name);
    tmiParent.DropDownItems.Add(tmiNew);
}

private void AddMenuNode(TreeNode tnParent, TreeNode tnNew, MenuEntity dMenu)
{
    tnNew.Text = dMenu.Name;
    tnNew.Tag = dMenu;
    tnParent.Nodes.Add(tnNew);
} 
```
