## 本项目-网格
网格相关的代码段。
### 绑定网格
```
// 绑定网格
FlexGridColumnDefinition fdc = new FlexGridColumnDefinition();
fdc.AddColumn(
    FlexGridColumn.NewRowNoCol(),
    new FlexGridColumn.Builder().Name(_sGridColumnSelect).Caption("选择").Type(DataGridViewColumnTypeEnum.CheckBox).Align(DataGridViewContentAlignment.MiddleCenter).Width(50).Edit(true).Visible().Build(),
    new FlexGridColumn.Builder().Name("file").Caption("代码相对文件路径").Type(DataGridViewColumnTypeEnum.TextBox).Align(DataGridViewContentAlignment.MiddleLeft).Width(900).Edit(true).Visible().Build()
    );
dgvInput.Tag = fdc.GetGridTagString();
dgvInput.BindDataGridView(null, false);
dgvInput.AllowUserToAddRows = true;
```
### 网格中下拉框
```
//通用列网格跟所有列网格结构一样
FlexGridColumnDefinition fdc = new FlexGridColumnDefinition();
fdc.AddColumn(
    FlexGridColumn.NewRowNoCol(),
    new FlexGridColumn.Builder().Name(DataStandardStr.BigType).Caption("大类").Type(DataGridViewColumnTypeEnum.ComboBox).Align(DataGridViewContentAlignment.MiddleCenter).Width(60).Edit(false).Visible().Build(),
    new FlexGridColumn.Builder().Name(DataStandardStr.SmallType).Caption("小类").Type(DataGridViewColumnTypeEnum.ComboBox).Align(DataGridViewContentAlignment.MiddleCenter).Width(100).Edit(false).Visible().Build()
);
dgvQuery.Tag = fdc.GetGridTagString();
dgvQuery.BindDataGridView(dtCommonCol.Clone(), true);
//大类下拉框
var cmbBig = (DataGridViewComboBoxColumn)dgvQuery.Columns[DataStandardStr.BigType];
cmbBig.ValueMember = "vid";
cmbBig.DisplayMember = "name";
cmbBig.DataSource = dtDataType;
```

### 绑定网格列为复选框报错的处理
```
private void dgvInput_DataError(object sender, DataGridViewDataErrorEventArgs e)
{
    if (this.dgvInput.Columns[e.ColumnIndex].Name == _sGridColumnSelect)
    {
        return;
    }
}
```

### 右键删除网格多行
```
private void tsmiDelete_Click(object sender, EventArgs e)
{
    DataTable dt = dgvCodeClassRelConfig.GetBindingTable();
    //得到表字符清单
    SortedSet<string> set = new SortedSet<string>();
    for (int i = 0; i < dgvCodeClassRelConfig.SelectedCells.Count; i++)
    {
        set.Add(dgvCodeClassRelConfig.Rows[dgvCodeClassRelConfig.SelectedCells[i].RowIndex].Cells[JavaPublishFileConfig.ValueString.RelCodeDir].Value.ToString());
    }

    foreach (string sTable in set)
    {
        string sFiter = string.Format("{0}='{1}'", JavaPublishFileConfig.ValueString.RelCodeDir, sTable);
        DataRow[] drArr = dt.Select(sFiter);
        foreach (DataRow dr in drArr)
        {
            dt.Rows.Remove(dr);
        }
    }
}
```
### 网格头双击事件全选
```
private readonly string _sGridColumnSelect = "IsSelect";
private bool _allSelectFile = false;//默认全选，这里取反

private void dgvInput_ColumnHeaderMouseDoubleClick(object sender, DataGridViewCellMouseEventArgs e)
{
    SelectAllOrCancel(dgvInput, ref _allSelectFile, e);
}

private void SelectAllOrCancel(DataGridView dgv, ref bool isSelect, DataGridViewCellMouseEventArgs e)
{
    if (e.ColumnIndex == dgv.Columns[_sGridColumnSelect].Index)
    {
        foreach (DataGridViewRow item in dgv.Rows)
        {
            item.Cells[_sGridColumnSelect].Value = isSelect ? "1" : "0";
        }
        isSelect = !isSelect;
    }
}
```
### 右键全选/全不选
```
private void tsmiChooseOrNot_Click(object sender, EventArgs e)
{
    DataGridView dgvOldNewChar = ((sender as ToolStripMenuItem).Owner as ContextMenuStrip).SourceControl as DataGridView;
    if (dgvOldNewChar.SelectedCells == null || dgvOldNewChar.SelectedCells.Count == 0) return;
    if (dgvOldNewChar.CurrentCell.ColumnIndex != dgvOldNewChar.Columns[_sGridColumnSelect].Index)
    {
        return; //选择、条件、MyBatis动态列
    }
    //选择
    string sSelectValue = dgvOldNewChar.CurrentCell.Value.ToString();
    if ("1".equals(sSelectValue))
    {
        sSelectValue = "true";
    }
    else if ("0".equals(sSelectValue))
    {
        sSelectValue = "false";
    }
    bool sNew = bool.Parse(sSelectValue) ? false : true;
    foreach (DataGridViewCell item in dgvOldNewChar.SelectedCells)
    {
        //为了防止选了其他列，这里只针对选择列赋值
        if (item.ColumnIndex == dgvOldNewChar.Columns[_sGridColumnSelect].Index)
        {
            item.Value = sNew;
        }
    }

    dgvOldNewChar.CurrentCell.Value = sNew;

    //解决当开始是全部选中，双击后全部取消选 中，但因为焦点没有离开选择列，显示还是选中状态的问题
    dgvOldNewChar.ChangeCurrentCell(dgvOldNewChar.CurrentCell.ColumnIndex);
}
```

### 按Control+V粘贴
```
private void dgvInput_KeyDown(object sender, KeyEventArgs e)
{
    if (e.Modifiers == Keys.Control && e.KeyCode == Keys.V)
    {
        PasteTextFromClipse();
    }
}

private void PasteTextFromClipse()
{
    try
    {
        string pasteText = Clipboard.GetText().Trim();
        if (string.IsNullOrEmpty(pasteText))//包括IN的为生成的SQL，不用粘贴
        {
            return;
        }

        DataTable dtMain = dgvInput.GetBindingTable();
        if (!ckbIsPasteAppend.Checked && dtMain.Rows.Count > 0)
        {
            dtMain.Clear();
        }
        foreach (DataRow dr in dtMain.Select("file is null or file=''"))
        {
            dtMain.Rows.Remove(dr);
        }

        DataTable dtNew = dtMain.Copy();
        pasteText.GetFirstColumnTable(dtNew, true, false, false,true,"ROWNO", "file",true);
        dgvInput.BindDataGridView(dtNew, true);
        dgvInput.ShowRowNum(true); //显示行号
        dgvInput.AllowUserToAddRows = true;
    }
    catch (Exception ex)
    {
        ShowErr(ex.Message);
    }
}
```

### 右键清空
```
private void tsmiClear_Click(object sender, EventArgs e)
{
    dgvInput.GetBindingTable().Clear();
}
```